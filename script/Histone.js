window.Histone=function(){var p=function(a){this.baseURI="";this.vars=[{}];this.macros=[{}];this.stackPointer=0;this.context=a};p.prototype.setBaseURI=function(a){this.baseURI=a};p.prototype.getBaseURI=function(){return this.baseURI};p.prototype.putVar=function(a,b){this.vars[this.stackPointer][a]=b};p.prototype.getVar=function(a,b){var d=this.vars,e,h=this.stackPointer;do if(e=d[h],e.hasOwnProperty(a))return b(e[a],!0);while(h--);b()};p.prototype.putMacro=function(a,b,d,e){this.macros[this.stackPointer][a]=[b,d,e]};p.prototype.getMacro=function(a){var b=this.macros,d,e=this.stackPointer;do if(d=b[e],d.hasOwnProperty(a))return d[a];while(e--)};p.prototype.save=function(){this.vars.push({});this.macros.push({});this.stackPointer++};p.prototype.restore=function(){this.vars.pop();this.macros.pop();this.stackPointer--};var ka=-1,N=0,la=2,ma=3,y=function(){function a(){if(i!==q)if(p=g[m],n=p[0].exec(f)){r=n.length;for(v=1;v<r;v++)if(D=n[v]){A=n.index;if(w=A-i)k=j.push({type:N,pos:i,value:f.substr(i,w)}),i+=w;w=D.length;i=A+w;s=p[1][v-1];switch(s[0]){case la:k=j.push({type:s[1],pos:A,value:D});break;case ma:k=j.push({type:s[1],pos:A,len:w});break;default:a()}break}}else{if(w=q-i)k=j.push({type:N,pos:i,value:f.substr(i,w)}),i+=w}else k=j.push({type:ka,value:"EOF",pos:q})}function b(){k||a();k--;l=j.shift();o=l.type;if(h.hasOwnProperty(o)){var b=h[o];m!==b&&(g[b][0].lastIndex=g[m][0].lastIndex,m=b)}}function d(a,b,d){"object"!==typeof a&&(a=[a]);void 0===d&&(d=0);c[d]||(c[d]=[]);g[d]||(g[d]=[[],[]]);e++;c[d].push("("+a.join("|")+")");g[d][1].push([b,e]);return e}var e=0,h={},c={},g={},f,q,i,j,k,l,o,m,n,r,v,A,D,w,p,s;this.addToken=function(a,b){return d(a,la,b)};this.addLiteral=function(a,b){return d(a,ma,b)};this.addIgnore=function(a,b){return d(a,1,b)};this.tokenize=function(a,d){i=0;j=[];k=0;o=l=null;f=a;q=a.length;void 0===d&&(d=0);m=d;for(d in g)g[d][0]=RegExp(c[d].join("|"),"g");b()};this.addTransition=function(a,b){void 0===b&&(b=0);h[a]=b};this.getLineNumber=function(){for(var a=-1,b=1,d,e=l.pos;++a<e;)d=f.charCodeAt(a),(10===d||13===d)&&b++;return b};this.getFragment=function(){return l.value?l.value:f.substr(l.pos,l.len)};this.test=function(a){return l.type===a};this.next=function(a){if(void 0===a||this.test(a))return a=l,b(),a}};y.T_EOF=ka;y.T_FRAGMENT=N;var i,B=y,pa=function(a){a=a.slice(1,-1);return a.replace(oa||(oa=RegExp("\\\\(t|b|n|r|f|'|\"|\\\\|\\x[0-9A-F]{2}|\\u[0-9A-F]{4})","g")),function(a,d){switch(d[0]){case "'":return"'";case '"':return'"';case "\\":return"\\";case "b":return String.fromCharCode(8);case "t":return String.fromCharCode(9);case "n":return String.fromCharCode(10);case "f":return String.fromCharCode(12);case "r":return String.fromCharCode(13);case "u":return String.fromCharCode(parseInt(d.substr(1),16));case "x":return String.fromCharCode(parseInt(d.substr(1),16))}})},c,oa,O,J,P,K,Q,l,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa,R,Ba,S,T,E,U,Ca,V,W,Da,Ea,Fa,Ga,Ha,Ia,Ja,X,F,G,x,Ka,La,L,H,Ma,Y,Z,Na,n,$,t,f=function(){function a(a,b){var b=b||c.getFragment(),d=c.getLineNumber(),e=v+"("+d+') Syntax error, "'+a+'" expected, but "'+b+'" found';return{file:v,line:d,expected:a,found:b,toString:function(){return e}}}function b(){if(c.next(va))return[f.T_NULL];if(c.next(za))return[f.T_TRUE];if(c.next(Aa))return[f.T_FALSE];if(c.test(Ea)){var b=c.next(),b=parseInt(b.value,10);return[f.T_INT,b]}if(c.test(Da))return b=c.next(),b=parseFloat(b.value,10),[f.T_DOUBLE,b];if(c.test($))return b=c.next(),b=pa(b.value),[f.T_STRING,b];if(c.next(X)){var b=[],d,e;if(!c.test(F))for(;;){d=null;e=q();if(c.next(L)){if(e[0]!==f.T_STRING&&e[0]!==f.T_INT&&(e[0]!==f.T_SELECTOR||1!==e[1].length))throw new a("identifier, string, number");d=e[0]!==f.T_SELECTOR?e[1]:e[1][0];e=q()}b.push([d,e]);if(!c.next(H))break}if(!c.next(F))throw new a("]");return[f.T_MAP,b]}if(c.test(t))return b=c.next(),[f.T_SELECTOR,[b.value]];if(c.next(wa))return[f.T_SELECTOR,["this"]];if(c.next(xa))return[f.T_SELECTOR,["self"]];if(c.next(ya))return[f.T_SELECTOR,["global"]];if(c.next(G)){if(c.next(x))throw new a("expression","()");try{b=q()}finally{if(!c.next(x))throw new a(")");}return b}throw new a("expression");}function d(){var e;if(!(e=c.next(ta)&&[f.T_NOT,d()])){c.next(Y);for(e=c.next(Z)?[f.T_NEGATE,b()]:b();;)if(c.next(Ma)){if(!c.test(t))throw new a("identifier");e[0]!==f.T_SELECTOR&&(e=[f.T_SELECTOR,[e]]);e[1].push(c.next().value)}else if(c.next(X)){if(c.next(F))throw new a("expression","[]");e[0]!==f.T_SELECTOR&&(e=[f.T_SELECTOR,[e]]);e[1].push(q());if(!c.next(F))throw new a("]");}else if(e[0]===f.T_SELECTOR&&c.next(G)){var h=null,g;if(!c.next(x)){for(h=[];!(h.push(q()),!c.next(H)););if(!c.next(x))throw new a(")");}g=e[1].pop();e=[f.T_CALL,e[1].length?e:null,g,h]}else break}return e}function e(){for(var a=d();c.next(Na)&&(a=[f.T_MUL,a,d()])||c.next(n)&&(a=[f.T_DIV,a,d()])||c.next(ua)&&(a=[f.T_MOD,a,d()]););return a}function h(){for(var a=e();c.next(Y)&&(a=[f.T_ADD,a,e()])||c.next(Z)&&(a=[f.T_SUB,a,e()]););return a}function g(){var a=h();return c.next(Ga)&&[f.T_LESS_OR_EQUAL,a,h()]||c.next(Ia)&&[f.T_LESS_THAN,a,h()]||c.next(Ha)&&[f.T_GREATER_OR_EQUAL,a,h()]||c.next(Ja)&&[f.T_GREATER_THAN,a,h()]||a}function i(){for(var a=g();c.next(qa)&&(a=[f.T_EQUAL,a,g()])||c.next(Fa)&&(a=[f.T_NOT_EQUAL,a,g()]););return a}function na(){for(var a=i();c.next(sa)&&(a=[f.T_AND,a,i()]););return a}function q(){var a;for(a=na();c.next(ra)&&(a=[f.T_OR,a,na()]););for(;c.next(Ka);)a=[f.T_TERNARY,a,q()],c.next(L)&&a.push(q());return a}function j(){if(c.next(V)){var b=c.next(t);if(!b)throw new a("identifier");var e;if(c.next(La)){if(e=q(),!c.next(l))throw new a("}}");}else{if(!c.next(l))throw new a("}}");e=[f.T_STATEMENTS,u(n)];if(!c.next(n)||!c.next(V)||!c.next(l))throw new a("{{/var}}");}return[f.T_VAR,b.value,e]}}function k(){if(c.next(S)){for(var b=[],e,d;;){e=q();if(!c.next(l))throw new a("}}");d=u(n,E,T);b.push([e,d]);if(!c.next(T))break}if(c.next(E)){if(!c.next(l))throw new a("}}");d=u(n);b.push([[f.T_TRUE],d])}if(!c.next(n)||!c.next(S)||!c.next(l))throw new a("{{/if}}");return[f.T_IF,b]}}function o(){if(c.next(U)){var b=c.next(t);if(!b)throw new a("identifier");b=[b.value];if(c.next(L)){var e=c.next(t);if(!e)throw new a("identifier");b.unshift(e.value)}if(!c.next(Ca))throw new a("in");e=q();if(!c.next(l))throw new a("}}");var d=[u(n,E)];if(c.next(E)){if(!c.next(l))throw new a("}}");d.push(u(n))}if(!c.next(n)||!c.next(U)||!c.next(l))throw new a("{{/for}}");return[f.T_FOR,b,e,d]}}function m(){if(c.next(W)){var b=c.next(t);if(!b)throw new a("identifier");var e=[];if(c.next(G)&&!c.next(x)){for(;;){var d=c.next(t);if(!d)throw new a("identifier");e.push(d.value);if(!c.next(H))break}if(!c.next(x))throw new a(")");}if(!c.next(l))throw new a("}}");d=u(n);if(!c.next(n)||!c.next(W)||!c.next(l))throw new a("{{/macro}}");return[f.T_MACRO,b.value,e,d]}}function r(){if(c.next(R)){var b=c.next(t);if(!b)throw new a("identifier");var e=[];if(c.next(G)&&!c.next(x)){for(;!(e.push(q()),!c.next(H)););if(!c.next(x))throw new a(")");}if(!c.next(l))throw new a("}}");e.push([f.T_STATEMENTS,u(n)]);if(!c.next(n)||!c.next(R)||!c.next(l))throw new a("{{/call}}");return[f.T_CALL,null,b.value,e]}}function s(){if(c.next(Ba)){var b=c.next($);if(!b)throw new a("string");b=pa(b.value);if(!c.next(l))throw new a("}}");return[f.T_IMPORT,b]}}function p(){var b=q();if(!c.next(l))throw new a("}}");return b}function u(){for(var b=[];!c.next(B.T_EOF);){for(;c.next(O);){for(;!c.test(J)&&!c.next(B.T_EOF);)c.next();if(!c.next(J))throw new a("*}}");}for(;c.next(P);){for(var e="";!c.test(K)&&!c.next(B.T_EOF);)e+=c.next().value;if(!c.next(K))throw new a("%}}");b.push(e)}if(c.next(Q)){if(e=Array.prototype.slice.call(arguments)){for(var d=!1;e.length;)if(c.test(e.shift())){d=!0;break}if(d)break}c.next(l)||b.push(k()||o()||j()||m()||r()||s()||p())}else c.test(B.T_FRAGMENT)&&b.push(c.next().value)}return b}var v;this.parse=function(a,b){v=b||"template";c||(c=new B,O=c.addLiteral("{{\\*",0),J=c.addLiteral("\\*}}",2),P=c.addLiteral("{{%",0),K=c.addLiteral("%}}",3),Q=c.addLiteral("{{",0),l=c.addLiteral("}}",1),qa=c.addLiteral("is\\b",1),ra=c.addLiteral("or\\b",1),sa=c.addLiteral("and\\b",1),ta=c.addLiteral("not\\b",1),ua=c.addLiteral("mod\\b",1),wa=c.addLiteral("this\\b",1),xa=c.addLiteral("self\\b",1),ya=c.addLiteral("global\\b",1),va=c.addLiteral("null\\b",1),za=c.addLiteral("true\\b",1),Aa=c.addLiteral("false\\b",1),R=c.addLiteral("call\\b",1),Ba=c.addLiteral("import\\b",1),S=c.addLiteral("if\\b",1),T=c.addLiteral("elseif\\b",1),E=c.addLiteral("else\\b",1),U=c.addLiteral("for\\b",1),Ca=c.addLiteral("in\\b",1),V=c.addLiteral("var\\b",1),W=c.addLiteral("macro\\b",1),Da=c.addToken(["(?:[0-9]*\\.)?[0-9]+[eE][\\+\\-]?[0-9]+","[0-9]*\\.[0-9]+"],1),Ea=c.addToken("[0-9]+",1),Fa=c.addLiteral("isNot\\b",1),Ga=c.addLiteral("<=",1),Ha=c.addLiteral(">=",1),Ia=c.addLiteral("<",1),Ja=c.addLiteral(">",1),X=c.addLiteral("\\[",1),F=c.addLiteral("\\]",1),G=c.addLiteral("\\(",1),x=c.addLiteral("\\)",1),Ka=c.addLiteral("\\?",1),La=c.addLiteral("=",1),L=c.addLiteral(":",1),H=c.addLiteral(",",1),Ma=c.addLiteral("\\.",1),Y=c.addLiteral("\\+",1),Z=c.addLiteral("\\-",1),Na=c.addLiteral("\\*",1),n=c.addLiteral("\\/",1),$=c.addToken(["'(?:[^'\\\\]|\\\\.)*'",'"(?:[^"\\\\]|\\\\.)*"'],1),t=c.addToken("[a-zA-Z_$][a-zA-Z0-9_$]*",1),c.addIgnore("[\t\n\r ]+",1),c.addTransition(O,2),c.addTransition(J,0),c.addTransition(P,3),c.addTransition(K,0),c.addTransition(Q,1),c.addTransition(l,0));c.tokenize(a,0);return u()}};f.T_OR=1;f.T_AND=2;f.T_EQUAL=3;f.T_NOT_EQUAL=4;f.T_LESS_OR_EQUAL=5;f.T_LESS_THAN=6;f.T_GREATER_OR_EQUAL=7;f.T_GREATER_THAN=8;f.T_ADD=9;f.T_SUB=10;f.T_MUL=11;f.T_DIV=12;f.T_MOD=13;f.T_NEGATE=14;f.T_NOT=15;f.T_TRUE=16;f.T_FALSE=17;f.T_NULL=100;f.T_INT=101;f.T_DOUBLE=102;f.T_STRING=103;f.T_TERNARY=104;f.T_SELECTOR=105;f.T_CALL=106;f.T_MAP=107;f.T_STATEMENTS=109;f.T_IMPORT=110;f.T_IF=1E3;f.T_VAR=1001;f.T_FOR=1002;f.T_MACRO=1003;i=f;var aa=function(a){var a=a.split("/"),b=""===a[0],d=[],e="";for(b&&a.shift();a.length;)e=a.shift(),".."===e?d.pop():"."!==
e&&d.push(e);b&&d.unshift("");("."===e||".."===e)&&d.push("");return d.join("/")},ba=function(a){return"string"===typeof a},ca=function(a){a=a.match(Xa);return{scheme:a[1]||null,authority:a[2]||null,path:a[3]||null,query:a[4]||null,fragment:a[5]||null}},Oa=0,Pa=0,Ya=/^(.*)\//,Xa=/^(?:([^:\/?\#]+):)?(?:\/\/([^\/?\#]*))?([^?\#]*)(?:\?([^\#]*))?(?:\#(.*))?/,y={T_UNDEFINED:1,T_NULL:2,T_BOOLEAN:3,T_NUMBER:4,T_STRING:5,T_FUNCTION:6,T_ARRAY:7,T_OBJECT:8,isUndefined:function(a){return void 0===a},isNull:function(a){return null===a},isBoolean:function(a){return"boolean"===typeof a},isNumber:function(a){return"number"===typeof a},isString:ba,isArray:function(a){return a instanceof Array},isObject:function(a){return a instanceof Object},isFunction:function(a){return a instanceof Function},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},getBaseType:function(a){if(null===a)return 2;if(a instanceof Array)return 7;switch(typeof a){case "undefined":return 1;case "boolean":return 3;case "number":return 4;case "string":return 5;case "function":return 6;case "object":return 8}},uniqueId:function(a){ba(a)||(a="");var b=(new Date).getTime();b>Oa?Pa=0:b+=++Pa;Oa=b;return a+b.toString(36)+(1+Math.floor(32767*Math.random())).toString(36)+(1+Math.floor(32767*Math.random())).toString(36)},forEachAsync:function(a,b,d){a instanceof Object||d();var e,h,c,g,f=-1,i=0,j=!1;a instanceof Array?c=a.length:(e=Object.keys(a),c=e.length);g=c-1;var k=function(){i+=1;if(!j){for(j=!0;0<i;){i-=1;f+=1;if(f===c)return d();h=e?e[f]:f;b(a[h],function(a){!0===a?d():k()},h,f,g)}j=!1}};k()},uri:{parse:ca,resolve:function(a,b,d){var a=ca(a),b=ca(b),e="",h="";if(a.scheme){e+=a.scheme+":";if(h=a.authority)e+="//"+h;if(h=aa(a.path))e+=h;if(h=a.query)e+="?"+h}else{if(h=b.scheme)e+=h+":";if(h=a.authority){e+="//"+h;if(h=aa(a.path))e+=h;if(h=a.query)e+="?"+h}else{if(h=b.authority)e+="//"+h;if(h=a.path){if(h=aa("/"===h.charAt(0)?h:(b.authority&&!b.path?"/":(b.path.match(Ya)||[""])[0])+h))e+=h;if(h=a.query)e+="?"+h}else{if(h=b.path)e+=h;if((h=a.query)||(h=b.query))e+=h}}}d&&(e+=d);if(h=a.fragment)e+="#"+h;return e},parseQuery:function(a){var b={};if(!ba(a))return{};for(var a=a.split("&"),d,e=a.length,h=0;h<e;h++)d=a[h].split("=",2),b[d[0]]=d[1];return b}}},o,m=y,Qa=function(){var a=-1,b=[],d=[];this.concat=function(e){if(!(e instanceof this.constructor))return this;a=0;for(var h=[],c=[],g=e.keys(),e=e.values(),f=0;f<d.length;f++){var i=b[f];m.isNumeric(i)?h.push(a++):h.push(i);c.push(d[f])}for(f=0;f<e.length;f++)i=g[f],m.isNumeric(i)?h.push(a++):h.push(i),c.push(e[f]);a--;b=h;d=c;return this};this.length=function(){return d.length};this.keys=function(){return b};this.values=function(){return d};this.hasKey=function(a){return!m.isString(a)&&!m.isNumber(a)?!1:-1!==b.indexOf(""+a)};this.join=function(a){m.isString(a)||(a="");return d.join(a)};this.get=function(a){if(m.isString(a)||m.isNumber(a))return a=b.indexOf(""+a),-1===a?void 0:d[a]};this.set=function(e,h){if(m.isString(e)||m.isNumber(e)){var e=""+e,c=b.indexOf(e);-1===c?(m.isNumeric(e)&&e>a&&(a=parseInt(e)),b.push(e),d.push(h)):d[c]=h}else e=""+ ++a,b.push(e),d.push(h);return this};this.remove=function(a){if(!m.isString(a)&&!m.isNumber(a))return this;a=b.indexOf(""+a);if(-1===a)return this;b.splice(a,1);d.splice(a,1);return this};this.clone=function(){var a,h,c,g=b.length,f=new Qa;for(c=0;c<g;c++)a=b[c],h=d[c],f.set(a,h);return f};this.slice=function(a,h){var c=d.length;m.isNumber(a)||(a=0);0>a&&(a=c+a);0>a&&(a=0);if(a>=c)return[];m.isNumber(h)||(h=0);0===h&&(h=c-a);0>h&&(h=c-a+h);if(0>=h)return[];b=b.slice(a,a+h);d=d.slice(a,a+h);return this};this.toObject=function(){var a,h=b.length,c,g,f=0,i=!0;for(c=0;c<h;c++){g=b[c];if(!m.isNumeric(g)||f!==parseInt(g)){i=!1;break}f++}a=i?[]:{};for(c=0;c<h;c++)f=d[c],f instanceof this.constructor&&(f=f.toObject()),i?a.push(f):(g=b[c],a[g]=f);return a}};o=Qa;var da=function(a){var a=a.split("/"),b=""===a[0],d=[],e="";for(b&&a.shift();a.length;)e=a.shift(),".."===e?d.pop():"."!==e&&d.push(e);b&&d.unshift("");("."===e||".."===e)&&d.push("");return d.join("/")},ea=function(a){return"string"===typeof a},fa=function(a){a=a.match(Za);return{scheme:a[1]||null,authority:a[2]||null,path:a[3]||null,query:a[4]||null,fragment:a[5]||null}},Ra=0,Sa=0,$a=/^(.*)\//,Za=/^(?:([^:\/?\#]+):)?(?:\/\/([^\/?\#]*))?([^?\#]*)(?:\?([^\#]*))?(?:\#(.*))?/,g=y={T_UNDEFINED:1,T_NULL:2,T_BOOLEAN:3,T_NUMBER:4,T_STRING:5,T_FUNCTION:6,T_ARRAY:7,T_OBJECT:8,isUndefined:function(a){return void 0===a},isNull:function(a){return null===a},isBoolean:function(a){return"boolean"===typeof a},isNumber:function(a){return"number"===typeof a},isString:ea,isArray:function(a){return a instanceof Array},isObject:function(a){return a instanceof Object},isFunction:function(a){return a instanceof Function},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},getBaseType:function(a){if(null===a)return 2;if(a instanceof Array)return 7;switch(typeof a){case "undefined":return 1;case "boolean":return 3;case "number":return 4;case "string":return 5;case "function":return 6;case "object":return 8}},uniqueId:function(a){ea(a)||(a="");var b=(new Date).getTime();b>Ra?Sa=0:b+=++Sa;Ra=b;return a+b.toString(36)+(1+Math.floor(32767*Math.random())).toString(36)+(1+Math.floor(32767*Math.random())).toString(36)},forEachAsync:function(a,b,d){a instanceof Object||d();var e,h,c,g,f=-1,i=0,j=!1;a instanceof Array?c=a.length:(e=Object.keys(a),c=e.length);g=c-1;var k=function(){i+=1;if(!j){for(j=!0;0<i;){i-=1;f+=1;if(f===c)return d();h=e?e[f]:f;b(a[h],function(a){!0===a?d():k()},h,f,g)}j=!1}};k()},uri:{parse:fa,resolve:function(a,b,d){var a=fa(a),b=fa(b),e="",c="";if(a.scheme){e+=a.scheme+":";if(c=a.authority)e+="//"+c;if(c=da(a.path))e+=c;if(c=a.query)e+="?"+c}else{if(c=b.scheme)e+=c+":";if(c=a.authority){e+="//"+c;if(c=da(a.path))e+=c;if(c=a.query)e+="?"+c}else{if(c=b.authority)e+="//"+c;if(c=a.path){if(c=da("/"===c.charAt(0)?c:(b.authority&&!b.path?"/":(b.path.match($a)||[""])[0])+c))e+=c;if(c=a.query)e+="?"+c}else{if(c=b.path)e+=c;if((c=a.query)||(c=b.query))e+=c}}}d&&(e+=d);if(c=a.fragment)e+="#"+c;return e},parseQuery:function(a){var b={};if(!ea(a))return{};for(var a=a.split("&"),d,e=a.length,c=0;c<e;c++)d=a[c].split("=",2),b[d[0]]=d[1];return b}}},s=function(a){switch(g.getBaseType(a)){case g.T_BOOLEAN:return a;case g.T_NUMBER:return 0!==a;case g.T_STRING:return 0<a.length;case g.T_OBJECT:return a instanceof o;default:return!1}},z=function(a){switch(g.getBaseType(a)){case g.T_UNDEFINED:return"";case g.T_NULL:case g.T_STRING:case g.T_BOOLEAN:return""+a;case g.T_NUMBER:a=(""+a).toLowerCase();if(-1===a.indexOf("e"))return a;var a=a.split("e"),b=a[0],d=a[1],a=b[0],e=d[0];"+"===a||"-"===a?b=b.substr(1):a="";"+"===e||"-"===e?d=d.substr(1):e="+";var c,f;c=b.indexOf(".");-1===c?(f=0,c=b.length):(f=b.substr(c+1).length,c=b.substr(0,c).length,b=b.replace(/\./g,""));c=d-c;"+"===e&&(c=d-f);f="";for(d=0;d<c;d++)f+="0";return"+"===e?a+b+f:a+"0."+f+b}if(g.isObject(a)&&a instanceof o){b=a.values();for(d=0;d<b.length;d++)b[d]=z(b[d]);return b.join(" ")}return""},Ta=function(a,b,d){var e=new XMLHttpRequest;e.open("GET",a+"?"+Math.random(),!0);e.onreadystatechange=function(){if(4===e.readyState){var a=e.getResponseHeader("Content-type"),c=e.status;399<c&&600>c?d():b(e.responseText,a)}};e.send(null)},M=function(a,b,d,e){if(!g.isFunction(ga)||!0!==ga(a,b,function(b,e){g.isString(e)||(e=a);d(b,e)},e)){var c=g.uri.resolve(a,b);ha.hasOwnProperty(c)?d(ha[c],c):Ta(c,function(a){a=d(a,c);g.isUndefined(a)||(ha[c]=a)},function(){d(void 0,c)},e)}},r=function(a){if(!g.isFunction(a)){if(!g.isObject(a)||a instanceof o)return a;var b=new o,d;for(d in a)Object.prototype.hasOwnProperty.call(a,d)&&b.set(d,r(a[d]));return b}},ia=function(a){if(g.isObject(a)){if(a instanceof o)return a.toObject();for(var b in a)a[b]=ia(a[b])}return a},Ua=function(a,b,d){var e=a;switch(g.getBaseType(a)){case g.T_NULL:e=k.Type;break;case g.T_BOOLEAN:e=k.Type;break;case g.T_UNDEFINED:e=k.Type;break;case g.T_NUMBER:e=k.Number;break;case g.T_STRING:e=k.String}g.isObject(a)&&a instanceof o&&(e=k.Map);if(e.hasOwnProperty(b))return e[b];if(k.Type.hasOwnProperty(b))return k.Type[b];if(d&&e.hasOwnProperty(""))return e[""]},I=function(a,b,d,e){var c,f;g.forEachAsync(b,function(b,e){j(b,d,function(b){c=a;if(f=Ua(a,b,!0))g.isFunction(f)?f.call(d,c,[b],function(b){a=r(b);e()}):(a=r(f),e());else return a=void 0,e(!0)})},function(){e(a)})},Va=function(a,b,d,e){var c=a[0],g=a[1],a=a[2],f=d.getBaseURI(),i={arguments:b};d.save();d.setBaseURI(a);d.putVar("self",r(i));a=0;for(i=Math.min(b.length,c.length);a<i;a++)d.putVar(c[a],r(b[a]));return C(g,d,function(a){d.setBaseURI(f);d.restore();e(a)})},j=function(a,b,d){if(!g.isArray(a))return d(a);var e=a[0];switch(e){case i.T_INT:case i.T_STRING:case i.T_DOUBLE:d(a[1]);break;case i.T_SELECTOR:var a=a[1],c,f=a.slice(1),l=a[0];g.isString(l)?"global"===l?I(k.Global,f,b,d):"this"===l?I(b.context,f,b,d):b.getVar(l,function(a,e){if(e)return I(a,f,b,d);if(k.Global.hasOwnProperty(l))return I(k.Global,[l].concat(f),b,d);c=b.context;if(g.isObject(c)&&c instanceof o&&c.hasKey(l))return I(c,[l].concat(f),b,d);I(void 0,f,b,d)}):j(l,b,function(a){I(a,f,b,d)});break;case i.T_VAR:var m=a[1],a=a[2];b.save();j(a,b,function(a){b.restore();b.putVar(m,a);d("")});break;case i.T_IF:var q="";g.forEachAsync(a[1],function(a,d){j(a[0],b,function(e){if(!s(e))return d();b.save();C(a[1],b,function(a){q=a;b.restore();d(!0)})})},function(){d(q)});break;case i.T_CALL:var n=a[1],p=a[3];j(a[2],b,function(a){var e=[];g.isArray(p)||(p=[]);g.forEachAsync(p,function(a,d){j(a,b,function(a){e.push(a);d()})},function(){var c=null;if(g.isNull(n)){if(c=b.getMacro(a))return Va(c,e,b,d);n=k.Global}j(n,b,function(h){if(c=Ua(h,a))g.isFunction(c)?c.call(b,h,ia(e),function(a){d(r(a))}):d(r(c));else return d()})})});break;case i.T_TERNARY:var x=a[2],t=a[3];j(a[1],b,function(a){s(a)?j(x,b,d):t?j(t,b,d):d()});break;case i.T_IMPORT:var a=a[1],y=b.getBaseURI();b.imports||(b.imports={});var B=a+"#"+y;b.imports.hasOwnProperty(B)?
d():(b.imports[B]=!0,M(a,y,function(a,e){try{return a=k(a,e),b.setBaseURI(e),C(a.getAST(),b,function(a){b.setBaseURI(y);d(a)}),a}catch(c){d()}}));break;case i.T_EQUAL:case i.T_NOT_EQUAL:var E=a[2];j(a[1],b,function(a){j(E,b,function(b){g.isString(a)&&g.isNumber(b)?g.isNumeric(a)?b=z(b):a=parseFloat(a,10):g.isNumber(a)&&g.isString(b)&&(g.isNumeric(b)?a=z(a):b=parseFloat(b,10));if(!g.isString(a)||!g.isString(b))g.isNumber(a)&&g.isNumber(b)?(a=parseFloat(a),b=parseFloat(b)):(a=s(a),b=s(b));b=a===b;d(e===i.T_EQUAL?b:!b)})});break;case i.T_STATEMENTS:C(a[1],b,d);break;case i.T_MACRO:b.putMacro(a[1],a[2],a[3],b.getBaseURI());d("");break;case i.T_MAP:var a=a[1],u=new o;g.forEachAsync(a,function(a,d){j(a[1],b,function(b){u.set(a[0],b);d()})},function(){d(u)});break;case i.T_ADD:var v=a[2];j(a[1],b,function(a){j(v,b,function(b){if(!g.isString(a)&&!g.isString(b)){if(g.isNumber(a)||g.isNumber(b)){g.isNumeric(a)&&(a=parseFloat(a,10));if(!g.isNumber(a))return d();g.isNumeric(b)&&(b=parseFloat(b,10));return!g.isNumber(b)?d():d(a+b)}if(a instanceof o&&b instanceof o){var e=a.clone(),e=e.concat(b);return d(e)}}a=z(a);b=z(b);d(a+b)})});break;case i.T_FOR:var A=a[1],D=a[3];j(a[2],b,function(a){if(a instanceof o&&a.length()){var e="",c,h=a.keys(),a=a.values();g.forEachAsync(a,function(a,d,f,g,i){b.save();b.putVar(A[0],r(a));A[1]&&b.putVar(A[1],h[g]);c={last:i,index:g};b.putVar("self",r(c));C(D[0],b,function(a){e+=a;b.restore();d()})},function(){d(e)})}else D[1]?(b.save(),C(D[1],b,function(a){b.restore();d(a)})):d("")});break;case i.T_TRUE:d(!0);break;case i.T_FALSE:d(!1);break;case i.T_OR:var w=a[2];j(a[1],b,function(a){s(a)?d(a):j(w,b,d)});break;case i.T_AND:var F=a[2];j(a[1],b,function(a){s(a)?j(F,b,d):d(a)});break;case i.T_NULL:d(null);break;case i.T_NOT:j(a[1],b,function(a){d(!s(a))});break;case i.T_SUB:case i.T_MUL:case i.T_DIV:case i.T_MOD:case i.T_NEGATE:var G=a[2];j(a[1],b,function(a){g.isNumeric(a)&&(a=parseFloat(a,10));if(!g.isNumber(a))return d();if(e===i.T_NEGATE)return d(-a);j(G,b,function(b){g.isNumeric(b)&&(b=parseFloat(b,10));if(!g.isNumber(b))return d();switch(e){case i.T_SUB:d(a-b);break;case i.T_MUL:d(a*b);break;case i.T_DIV:d(a/b);break;case i.T_MOD:d(a%b)}})});break;case i.T_LESS_THAN:case i.T_GREATER_THAN:case i.T_LESS_OR_EQUAL:case i.T_GREATER_OR_EQUAL:var H=a[2];j(a[1],b,function(a){j(H,b,function(b){g.isString(a)&&g.isNumber(b)?g.isNumeric(a)?a=parseFloat(a,10):b=z(b):g.isNumber(a)&&g.isString(b)&&(g.isNumeric(b)?b=parseFloat(b,10):a=z(a));if(!g.isNumber(a)||!g.isNumber(b))g.isString(a)&&g.isString(b)?(a=a.length,b=b.length):(a=s(a),b=s(b));switch(e){case i.T_LESS_THAN:d(a<b);break;case i.T_GREATER_THAN:d(a>b);break;case i.T_LESS_OR_EQUAL:d(a<=b);break;case i.T_GREATER_OR_EQUAL:d(a>=b)}})});break;default:throw d(),'unsupported template instruction "'+z(a)+'"';}},C=function(a,b,d){var e="";g.forEachAsync(a,function(a,d){g.isArray(a)?j(a,b,function(a){e+=z(a);d()}):(e+=a,d())},function(){d(e)})},Wa=function(a,b){g.isString(b)||(b=".");this.getAST=function(){return a};this.render=function(d,e){var e=r(e),c=new p(e);c.setBaseURI(b);C(a,c,d)};this.call=function(d,e,c,g){var f=new p(g),g=r(g);f.setBaseURI(b);C(a,f,function(){var a=f.getMacro(d);if(!a)return c();Va(a,e,f,function(a){c(ia(a))})})}},ha={},ga=null,ja=null,k=function(a,b){if(g.isString(a))ja||(ja=new i),a=ja.parse(a,b);else{if(a instanceof Wa)return a;if(!g.isArray(a))throw'"'+a+'" is not a string';}return new Wa(a,b)};k.OrderedMap=o;k.Type={isUndefined:function(a,b,d){d(g.isUndefined(a))},isNull:function(a,b,d){d(g.isNull(a))},isBoolean:function(a,b,d){d(g.isBoolean(a))},isNumber:function(a,b,d){d(g.isNumber(a))},isString:function(a,b,d){d(g.isString(a))},isMap:function(a,b,d){d(g.isObject(a)&&a instanceof o)},toJSON:function(a,b,d){if(g.isUndefined(a))return d("null");d(JSON.stringify(a))},toMap:function(a,b,d){if(a instanceof o)return d(a);d((new o).set(null,a))},toString:function(a,b,d){d(z(a))},toBoolean:function(a,b,d){d(s(a))}};k.Number={isInteger:function(a,b,d){d(0===a%1)},isFloat:function(a,b,d){d(0!==a%1)},toChar:function(a,b,d){d(String.fromCharCode(a))},toFixed:function(a,b,d){b=b[0];g.isNumber(b)&&0<=b?(b=Math.pow(10,b||0),d(Math.round(a*b)/b)):d(a)},abs:function(a,b,d){d(Math.abs(a))},floor:function(a,b,d){d(Math.floor(a))},ceil:function(a,b,d){d(Math.ceil(a))},round:function(a,b,d){d(Math.round(a))},pow:function(a,b,d){b=b[0];if(!g.isNumber(b))return d();d(Math.pow(a,b))},log:function(a,b,d){if(0>=a)return d();b=b[0];g.isNumber(b)&&0<b?d(Math.log(a)/Math.log(b)):d(Math.log(a))}};k.String={"":function(a,b,d){b=parseFloat(b[0],10);if(isNaN(b))return d();var e=a.length;0>b&&(b=e+b);if(0!==b%1||0>b||b>=e)return d();d(a[b])},size:function(a,b,d){d(a.length)},strip:function(a,b,d){for(var e="",c;b.length;)c=b.shift(),g.isString(c)&&(e+=c);0===e.length&&(e=" \n\r\t");b=-1;for(c=a.length;b<c&&-1!==e.indexOf(a.charAt(++b)););for(;0<=c&&-1!==e.indexOf(a.charAt(--c)););d(a.slice(b,c+1))},slice:function(a,b,d){var e=b[0],b=b[1],c=a.length;g.isNumber(e)||(e=0);0>e&&(e=c+e);0>e&&(e=0);e<c?(g.isNumber(b)||(b=0),0===b&&(b=c-e),0>b&&(b=c-e+b),0>=b?d(""):d(a.substr(e,b))):d("")},test:function(a,b,d){b=b[0];d(g.isString(b)&&null!==a.match(b))},match:function(a,b,d){b=b[0];if(!g.isString(b))return d(!1);a=a.match(b);if(g.isNull(a))return d(!1);d(Array.prototype.slice.call(a,0))},toLowerCase:function(a,b,d){d(a.toLowerCase())},toUpperCase:function(a,b,d){d(a.toUpperCase())},split:function(a,b,d){b=b[0];d(a.split(g.isString(b)?b:""))},charCodeAt:function(a,b,d){b=parseFloat(b[0],10);if(isNaN(b))return d();var e=a.length;0>b&&(b=e+b);if(0!==b%1||0>b||b>=e)return d();d(a.charCodeAt(b))},toNumber:function(a,b,d){g.isNumeric(a)?d(parseFloat(a,10)):d()}};k.Map={"":function(a,b,d){d(a.get(b[0]))},size:function(a,b,d){d(a.length())},join:function(a,b,d){d(a.join(b[0]))},keys:function(a,b,d){d(a.keys())},values:function(a,b,d){d(a.values())},hasKey:function(a,b,d){d(a.hasKey(b[0]))},remove:function(a,b,d){for(var e=a.clone();b.length;)a=b.shift(),e.remove(a);d(e)},slice:function(a,b,d){var e=b[0],b=b[1],a=a.clone();a.slice(e,b);d(a)},toJSON:function(a,b,d){d(JSON.stringify(a.toObject()))}};k.Global={clientType:"browser",userAgent:window.navigator.userAgent,baseURI:function(a,b,d){d(this.getBaseURI())},resolveURI:function(a,b,d){d(g.uri.resolve(b[0],b[1]))},uniqueId:function(a,b,d){d(g.uniqueId())},loadJSON:function(a,b,d){var a=b[0],b=b[1],e=this.getBaseURI();M(a,e,function(a){if(!g.isString(a))return a=r(a),d(a);try{a=JSON.parse(a),a=r(a),d(a)}catch(b){d()}},b)},loadText:function(a,b,d){var a=b[0],b=b[1],e=this.getBaseURI();M(a,e,function(a){d(g.isString(a)?a:"")},b)},include:function(a,b,d){var a=b[0],e=b[1],b=this.getBaseURI();M(a,b,function(a,b){try{return a=k(a,b),a.render(d,r(e)),a}catch(c){d()}})},min:function(a,b,d){for(var a=b.length,e=void 0,c=0;c<a;c++)if(g.isNumber(b[c])&&(g.isUndefined(e)||b[c]<e))e=b[c];d(e)},max:function(a,b,d){for(var a=b.length,e=void 0,c=0;c<a;c++)if(g.isNumber(b[c])&&(g.isUndefined(e)||b[c]>e))e=b[c];d(e)},range:function(a,b,d){var a=[],c=parseFloat(b[0]),b=parseFloat(b[1]);if(!g.isNumber(c)||!g.isNumber(b)||0!==c%1||0!==b%1)return d(a);if(c>b)for(;c>=b;c-=1)a.push(c);else if(c<b)for(;c<=b;c+=1)a.push(c);else a.push(c);d(a)},dayOfWeek:function(a,b,d){var a=parseFloat(b[0]),c=parseFloat(b[1]),b=parseFloat(b[2]);if(!g.isNumber(a)||!g.isNumber(c)||!g.isNumber(b)||0!==a%1||0!==c%1||0!==b%1)return d();var f=new Date(a,c-=1,b);f.getFullYear()==a&&f.getMonth()==c&&f.getDate()==b?(b=f.getDay(),d(b?b:7)):d()},daysInMonth:function(a,b,c){a=parseFloat(b[0]);b=parseFloat(b[1]);if(!g.isNumber(a)||!g.isNumber(b)||0!==a%1||0!==b%1||1>b||12<b)return c();c((new Date(a,b,0)).getDate())}};k.load=function(a,b,c){var e=b.toUrl(a),e=g.uri.resolve(e,window.location.href);Ta(e,function(a,b){if("application/json"===b)try{a=JSON.parse(a)}catch(f){}c(k(a,e))},null)};k.setURIResolver=function(a){ga=g.isFunction(a)?a:null};return k}();